const cart = JSON.parse(localStorage.getItem('cart')) || [];

// Add to cart functionality
document.querySelectorAll('.add-to-cart').forEach(button => {
    button.addEventListener('click', function() {
        const menuItem = this.closest('.menu-item');
        const itemName = menuItem.getAttribute('data-name');
        const itemPrice = parseInt(menuItem.getAttribute('data-price'));

        const quantityInput = menuItem.querySelector('input[name="quantity"]');
        const quantity = parseInt(quantityInput.value);

        if (quantity && quantity > 0) {
            const existingItem = cart.find(item => item.name === itemName);

            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({ name: itemName, price: itemPrice, quantity: quantity });
            }

            alert(`${quantity} x ${itemName} added to cart`);
            updateCartCount();
            localStorage.setItem('cart', JSON.stringify(cart));
        }
    });
});

function updateCartCount() {
    const cartCount = cart.reduce((total, item) => total + item.quantity, 0);
    document.getElementById('cart-count').innerText = cartCount;
}

function getCartSummary() {
    return cart.map(item => `${item.quantity} x ${item.name} (UGX ${item.price} each)`).join('\n');
}

function handleOrderFormSubmit(event) {
    event.preventDefault();
    const form = event.target;
    const name = form.name.value;
    const email = form.email.value;
    const address = form.address.value;
    const phone = form.phone.value;

    // EmailJS configuration
    emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', {
        from_name: name,
        to_name: 'Chef Steven',
        message: getCartSummary(),
        reply_to: email,
        address: address,
        phone: phone
    }).then((response) => {
        console.log('SUCCESS!', response.status, response.text);
        alert('Order placed successfully!');
        // Optionally clear the cart and form
        localStorage.removeItem('cart');
        form.reset();
    }).catch((error) => {
        console.error('FAILED...', error);
    });
}

document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('order-summary')) {
        displayOrderSummary();
    }

    if (document.getElementById('order-form')) {
        const orderForm = document.getElementById('order-form');
        orderForm.addEventListener('submit', handleOrderFormSubmit);
    }

    updateCartCount();
});

function displayOrderSummary() {
    const orderSummaryContainer = document.getElementById('order-summary');
    let orderSummaryHtml = '';
    let totalCost = 0;

    cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        totalCost += itemTotal;

        orderSummaryHtml += `
            <div class="order-item">
                <h3>${item.name}</h3>
                <p>Price: UGX ${item.price}</p>
                <p>Quantity: ${item.quantity}</p>
                <p>Total: UGX ${itemTotal}</p>
            </div>
        `;
    });

    orderSummaryHtml += `<p>Total Cost: UGX ${totalCost}</p>`;
    orderSummaryContainer.innerHTML = orderSummaryHtml;
}
